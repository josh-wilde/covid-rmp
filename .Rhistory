source('config.R')
# Set the data directory
data_dir <- read.lines('data-directory.txt')
# Set the data directory
data_dir <- read_lines('data-directory.txt')
fpath <- file.path(data_dir, 'COVID-19', 'csse_covid_19_data', 'csse_covid_19_time_series')
# Deaths
fname <- 'time_series_covid19_deaths_US.csv'
read_csv(file.path(fpath, fname))
library(janitor)
read_csv(file.path(fpath, fname)) %>%
clean_names()
read_csv(file.path(fpath, fname))
read_csv(file.path(fpath, fname)) %>%
clean_names()
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips))
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips)) %>%
count(fips, sort=T)
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips)) %>%
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}'))
fname <- 'time_series_covid19_deaths_US.csv'
col_name <- 'covid_cumul_deaths'
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips)) %>%
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips, names_to = date, values_to = var('deaths'))
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips)) %>%
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips, names_to = date, values_to = sym('deaths'))
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips)) %>%
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips, names_to = date, values_to = !!sym('deaths'))
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips)) %>%
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips, names_to = date, values_to = !!sym(col_name))
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips)) %>%
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips, names_to = date, values_to = !!col_name)
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips)) %>%
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips, names_to = date, values_to = covid_cumul_deaths)
rlang::last_error()
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips)) %>%
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips, names_to = 'date', values_to = 'covid_cumul_deaths')
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips)) %>%
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips, names_to = 'date', values_to = col_name)
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips)) %>%
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips, names_to = 'date', values_to = col_name)
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips)) %>%
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips,
names_to = 'date',
values_to = col_name) %>%
group_by(fips) %>%
summarise(covid_cumul_deaths = sum(covid_cumul_deaths))
read_csv(file.path(fpath, fname)) %>% View()
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips=as.numeric(fips)) %>%
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips,
names_to = 'date',
values_to = col_name) %>%
group_by(fips) %>%
summarise(covid_cumul_deaths = sum(covid_cumul_deaths)) %>%
filter(length(fips) >= 4)
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
#mutate(fips=as.numeric(fips)) %>%
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips,
names_to = 'date',
values_to = col_name) %>%
group_by(fips) %>%
summarise(covid_cumul_deaths = sum(covid_cumul_deaths))
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips,
names_to = 'date',
values_to = col_name) %>%
group_by(fips) %>%
summarise(covid_cumul_deaths = sum(covid_cumul_deaths)) %>%
mutate(fips = as.numeric(fips))
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips,
names_to = 'date',
values_to = col_name) %>%
group_by(fips) %>%
summarise(covid_cumul_deaths = sum(covid_cumul_deaths)) %>%
mutate(fips = as.numeric(fips)) %>%
filter(fips >= 1000)
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips,
names_to = 'date',
values_to = col_name) %>%
group_by(fips) %>%
summarise(covid_cumul_deaths = sum(covid_cumul_deaths)) %>%
mutate(fips = as.numeric(fips)) %>%
filter(fips >= 1000 & fips < 80000) # excludes cruises, KC, Nantucket, couple "out of" areas, and islands/territories
clean_csse_ts <- function(fpath, fname, col_name){
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips,
names_to = 'date',
values_to = col_name) %>%
group_by(fips) %>%
summarise(covid_cumul_deaths = sum(covid_cumul_deaths)) %>%
mutate(fips = as.numeric(fips)) %>%
filter(fips >= 1000 & fips < 80000) # excludes cruises, KC, Nantucket, couple "out of" areas, and islands/territories
}
fpath <- file.path(data_dir, 'COVID-19', 'csse_covid_19_data', 'csse_covid_19_time_series')
fname <- 'time_series_covid19_deaths_US.csv'
col_name <- 'covid_cumul_deaths'
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips,
names_to = 'date',
values_to = col_name) %>%
group_by(fips) %>%
summarise(covid_cumul_deaths = sum(covid_cumul_deaths)) %>%
mutate(fips = as.numeric(fips)) %>%
filter(fips >= 1000 & fips < 80000) %>%  # excludes cruises, KC, Nantucket, couple "out of" areas, and islands/territories
write_csv(file.path(clean_path, clean_name))
clean_csse_ts <- function(fpath, fname, col_name, clean_path, clean_name){
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips,
names_to = 'date',
values_to = col_name) %>%
group_by(fips) %>%
summarise(covid_cumul_deaths = sum(covid_cumul_deaths)) %>%
mutate(fips = as.numeric(fips)) %>%
filter(fips >= 1000 & fips < 80000) %>%  # excludes cruises, KC, Nantucket, couple "out of" areas, and islands/territories
write_csv(file.path(clean_path, clean_name))
}
fpath <- file.path(data_dir, 'COVID-19', 'csse_covid_19_data', 'csse_covid_19_time_series')
fname <- 'time_series_covid19_deaths_US.csv'
col_name <- 'covid_cumul_deaths'
clean_csse_ts <- function(fpath, fname, col_name, clean_path, clean_fname){
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips,
names_to = 'date',
values_to = col_name) %>%
group_by(fips) %>%
summarise(covid_cumul_deaths = sum(covid_cumul_deaths)) %>%
mutate(fips = as.numeric(fips)) %>%
filter(fips >= 1000 & fips < 80000) %>%  # excludes cruises, KC, Nantucket, couple "out of" areas, and islands/territories
write_csv(file.path(clean_path, clean_name))
}
# Deaths
clean_csse_ts(fpath = file.path(data_dir, 'COVID-19', 'csse_covid_19_data', 'csse_covid_19_time_series'),
fname = 'time_series_covid19_deaths_US.csv',
col_name = 'covid_cumul_deaths',
clean_path = file.path(data_dir, 'clean_data'),
clean_fname = 'covid_cumul_deaths.csv')
clean_csse_ts <- function(fpath, fname, col_name, clean_path, clean_fname){
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips,
names_to = 'date',
values_to = col_name) %>%
group_by(fips) %>%
summarise(covid_cumul_deaths = sum(covid_cumul_deaths)) %>%
mutate(fips = as.numeric(fips)) %>%
filter(fips >= 1000 & fips < 80000) %>%  # excludes cruises, KC, Nantucket, couple "out of" areas, and islands/territories
write_csv(file.path(clean_path, clean_fname))
}
# Deaths
clean_csse_ts(fpath = file.path(data_dir, 'COVID-19', 'csse_covid_19_data', 'csse_covid_19_time_series'),
fname = 'time_series_covid19_deaths_US.csv',
col_name = 'covid_cumul_deaths',
clean_path = file.path(data_dir, 'clean_data'),
clean_fname = 'covid_cumul_deaths.csv')
# Cases
clean_csse_ts(fpath = file.path(data_dir, 'COVID-19', 'csse_covid_19_data', 'csse_covid_19_time_series'),
fname = 'time_series_covid19_confirmed_US.csv',
col_name = 'covid_cumul_cases',
clean_path = file.path(data_dir, 'clean_data'),
clean_fname = 'covid_cumul_confirmed.csv')
clean_csse_ts <- function(fpath, fname, col_name, clean_path, clean_fname){
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips,
names_to = 'date',
values_to = col_name) %>%
group_by(fips) %>%
summarise(sum(!!sym(col_name))) %>%
mutate(fips = as.numeric(fips)) %>%
filter(fips >= 1000 & fips < 80000) %>%  # excludes cruises, KC, Nantucket, couple "out of" areas, and islands/territories
write_csv(file.path(clean_path, clean_fname))
}
# Deaths
clean_csse_ts(fpath = file.path(data_dir, 'COVID-19', 'csse_covid_19_data', 'csse_covid_19_time_series'),
fname = 'time_series_covid19_deaths_US.csv',
col_name = 'covid_cumul_deaths',
clean_path = file.path(data_dir, 'clean_data'),
clean_fname = 'covid_cumul_deaths.csv')
clean_csse_ts <- function(fpath, fname, col_name, clean_path, clean_fname){
read_csv(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
select(fips, matches('x\\d{1,2}_\\d{1,2}_\\d{1,2}')) %>%
pivot_longer(cols = -fips,
names_to = 'date',
values_to = col_name) %>%
group_by(fips) %>%
summarise(!!col_name := sum(!!sym(col_name))) %>%
mutate(fips = as.numeric(fips)) %>%
filter(fips >= 1000 & fips < 80000) %>%  # excludes cruises, KC, Nantucket, couple "out of" areas, and islands/territories
write_csv(file.path(clean_path, clean_fname))
}
# Deaths
clean_csse_ts(fpath = file.path(data_dir, 'COVID-19', 'csse_covid_19_data', 'csse_covid_19_time_series'),
fname = 'time_series_covid19_deaths_US.csv',
col_name = 'covid_cumul_deaths',
clean_path = file.path(data_dir, 'clean_data'),
clean_fname = 'covid_cumul_deaths.csv')
# Cases
clean_csse_ts(fpath = file.path(data_dir, 'COVID-19', 'csse_covid_19_data', 'csse_covid_19_time_series'),
fname = 'time_series_covid19_confirmed_US.csv',
col_name = 'covid_cumul_cases',
clean_path = file.path(data_dir, 'clean_data'),
clean_fname = 'covid_cumul_confirmed.csv')
# Deaths
clean_covid_deaths <- function(){
clean_csse_ts(fpath = file.path(data_dir, 'COVID-19', 'csse_covid_19_data', 'csse_covid_19_time_series'),
fname = 'time_series_covid19_deaths_US.csv',
col_name = 'covid_cumul_deaths',
clean_path = file.path(data_dir, 'clean_data'),
clean_fname = 'covid_cumul_deaths.csv')
}
clean_covid_deaths()
# Cases
clean_covid_cases <- function() {
clean_csse_ts(fpath = file.path(data_dir, 'COVID-19', 'csse_covid_19_data', 'csse_covid_19_time_series'),
fname = 'time_series_covid19_confirmed_US.csv',
col_name = 'covid_cumul_cases',
clean_path = file.path(data_dir, 'clean_data'),
clean_fname = 'covid_cumul_confirmed.csv')
}
fpath <- file.path(data_dir, 'Claritas Data Files (Demographic)')
library(readxl)
read_excel(file.path(fpath, fname)) %>%
clean_names() #%>% # clean the column names
fpath <- file.path(data_dir, 'Claritas Data Files (Demographic)')
fname <- 'Pop-Facts 2020 Pop by Age and Sex_County.xlsx'
read_excel(file.path(fpath, fname)) %>%
clean_names() #%>% # clean the column names
read_excel(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips = as.numeric(comp_gcode))
read_excel(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips = as.numeric(comp_gcode)) %>%
select(comp_geo_level, comp_gcode, fips, everything())
clean_claritas <- function(fpath, fname, clean_path, clean_fname) {
read_excel(file.path(fpath, fname)) %>%
clean_names() %>% # clean the column names
mutate(fips = as.numeric(comp_gcode)) %>%
select(comp_geo_level, comp_gcode, fips, everything()) %>%
write_csv(file.path(clean_path, clean_fname))
}
clean_claritas(fpath = file.path(data_dir, 'Claritas Data Files (Demographic)'),
fname = 'Pop-Facts 2020 Pop by Age and Sex_County.xlsx',
clean_path = file.path(data_dir, 'clean_data'),
clean_fname = 'claritas_pop_age_sex_fips.csv')
